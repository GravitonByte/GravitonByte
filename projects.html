<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Proyectos</title>
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    />
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Press+Start+2P"
      rel="stylesheet"
    />
    <!-- Estilos -->
    <link rel="stylesheet" href="css/projects.css" />
  </head>

  <body>
    <!-- Fondo animado -->
    <canvas id="space"></canvas>

    <header>
      <nav>
        <a href="index.html">Inicio</a>
        <a href="about.html">Sobre mí</a>
        <a href="skills.html">Habilidades</a>
        <a href="projects.html" class="active">Proyectos</a>
        <a href="contact.html">Contacto</a>
      </nav>
    </header>

    <section class="home">
      <div class="home-content">
        <!-- Carrusel de habilidades -->
        <div class="carousel-container">
          <div class="nav-btn prev"><i class="fas fa-chevron-left"></i></div>
          <div class="carousel">
            <div class="carousel-track">
              <!-- Visor médico -->
              <div class="card" data-skill="95">
                <div class="card-inner">
                  <div class="card-front">
                    <div class="card-title">Visor médico</div>
                    <div class="card-image">
                      <img src="assets/icons/icon-rx.png" alt="HTML" />
                    </div>
                  </div>
                  <div class="card-back">
                    <div class="video-container">
                      <iframe
                        src="https://www.youtube.com/embed/qk_3SwXmpGM?rel=0&modestbranding=1&playsinline=1&autoplay=0&mute=0&enablejsapi=1"
                        title="YouTube video player"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen
                        loading="lazy"
                      >
                      </iframe>
                    </div>
                    <div class="skill-description">
                      Aplicación web para visualizar imágenes médicas.
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="nav-btn next"><i class="fas fa-chevron-right"></i></div>
        </div>
      </div>
    </section>

    <footer>
      <p class="pixel-art">&copy; 2025 GravitonByte</p>
    </footer>

    <!-- Script del fondo animado -->
    <script src="js/space.js"></script>

    <script>
      const track = document.querySelector(".carousel-track");
      const cards = Array.from(track.children);
      const prevButton = document.querySelector(".prev");
      const nextButton = document.querySelector(".next");
      let index = 0;

      function updateCarousel() {
        const gap = 20;
        const cardWidth = cards[0].offsetWidth;
        const moveAmount = cardWidth + gap;
        track.style.transform = `translateX(${-index * moveAmount}px)`;

        prevButton.classList.toggle("disabled", index === 0);
        nextButton.classList.toggle(
          "disabled",
          index >= cards.length - getCardsToShow()
        );
      }

      function getCardsToShow() {
        const w = window.innerWidth;
        if (w <= 768) return 1;
        if (w <= 1024) return 2;
        return 3;
      }

      nextButton.addEventListener("click", () => {
        if (index < cards.length - getCardsToShow()) {
          index++;
          updateCarousel();
        }
      });

      prevButton.addEventListener("click", () => {
        if (index > 0) {
          index--;
          updateCarousel();
        }
      });

      // === FLIP DE TARJETAS MEJORADO PARA MÓVIL ===
      let touchStartTime = 0;
      let isTouchingVideo = false;

      cards.forEach((card) => {
        const flipCard = () => {
          // Solo voltear si no estamos tocando el video
          if (isTouchingVideo) {
            isTouchingVideo = false;
            return;
          }

          cards.forEach((c) => c !== card && c.classList.remove("flipped"));
          card.classList.toggle("flipped");
        };

        // Click normal (escritorio)
        card.addEventListener("click", (e) => {
          // Si el click viene del iframe o su contenedor, ignorar
          if (
            e.target.closest("iframe") ||
            e.target.closest(".video-container")
          ) {
            return;
          }
          flipCard();
        });

        // Touch en móvil
        card.addEventListener("touchend", (e) => {
          const touch = e.changedTouches[0];
          const now = Date.now();

          // Si fue un toque rápido y no sobre el video
          if (now - touchStartTime < 500) {
            if (
              !e.target.closest("iframe") &&
              !e.target.closest(".video-container")
            ) {
              e.preventDefault(); // evita scroll accidental
              flipCard();
            }
          }
        });

        card.addEventListener("touchstart", (e) => {
          touchStartTime = Date.now();
          if (
            e.target.closest("iframe") ||
            e.target.closest(".video-container")
          ) {
            isTouchingVideo = true;
          }
        });

        // Detectar si se toca el video (incluso si está dentro del iframe)
        const iframe = card.querySelector("iframe");
        if (iframe) {
          iframe.addEventListener("touchstart", () => {
            isTouchingVideo = true;
          });

          // Para mayor seguridad: si se toca cualquier parte del contenedor del video
          iframe.parentElement.addEventListener("touchstart", (e) => {
            isTouchingVideo = true;
          });
        }
      });

      // Resetear al cambiar tamaño
      window.addEventListener("resize", () => {
        index = Math.max(0, Math.min(index, cards.length - getCardsToShow()));
        updateCarousel();
      });

      updateCarousel();
    </script>
  </body>
</html>
