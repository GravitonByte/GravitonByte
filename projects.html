<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Proyectos</title>
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    />
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Press+Start+2P"
      rel="stylesheet"
    />
    <!-- Estilos -->
    <link rel="stylesheet" href="css/projects.css" />
  </head>

  <body>
    <!-- Fondo animado -->
    <canvas id="space"></canvas>

    <header>
      <nav>
        <a href="index.html">Inicio</a>
        <a href="about.html">Sobre mí</a>
        <a href="skills.html">Habilidades</a>
        <a href="projects.html" class="active">Proyectos</a>
        <a href="contact.html">Contacto</a>
      </nav>
    </header>

    <section class="home">
      <div class="home-content">
        <!-- Carrusel de habilidades -->
        <div class="carousel-container">
          <div class="nav-btn prev"><i class="fas fa-chevron-left"></i></div>
          <div class="carousel">
            <div class="carousel-track">
              <!-- Visor médico -->
              <div class="card" data-skill="95">
                <div class="card-inner">
                  <div class="card-front">
                    <div class="card-title">Visor médico</div>
                    <div class="card-image">
                      <img src="assets/icons/icon-rx.png" alt="HTML" />
                    </div>
                  </div>
                  <div class="card-back">
                    <div class="video-container">
                      <iframe
                        data-src="https://www.youtube.com/embed/qk_3SwXmpGM?rel=0&modestbranding=1&playsinline=1&enablejsapi=1"
                        title="YouTube video player"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen
                        loading="lazy"
                      ></iframe>
                    </div>
                    <div class="skill-description">
                      Aplicación web para visualizar imágenes médicas.
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="nav-btn next"><i class="fas fa-chevron-right"></i></div>
        </div>
      </div>
    </section>

    <footer>
      <p class="pixel-art">&copy; 2025 GravitonByte</p>
    </footer>

    <!-- Script del fondo animado -->
    <script src="js/space.js"></script>

    <script>
      const track = document.querySelector(".carousel-track");
      const cards = Array.from(track.children);
      const prevButton = document.querySelector(".prev");
      const nextButton = document.querySelector(".next");
      let index = 0;

      function updateCarousel() {
        const gap = 20;
        const cardWidth = cards[0].offsetWidth;
        const moveAmount = cardWidth + gap;

        track.style.transform = `translateX(${-index * moveAmount}px)`;

        prevButton.classList.toggle("disabled", index === 0);
        nextButton.classList.toggle(
          "disabled",
          index >= cards.length - getCardsToShow()
        );
      }

      function getCardsToShow() {
        const w = window.innerWidth;
        if (w <= 768) return 1;
        if (w <= 1024) return 2;
        return 3;
      }

      // Cargar videos solo cuando sean necesarios
      function loadYouTubeVideo(iframe) {
        const dataSrc = iframe.getAttribute("data-src");
        if (dataSrc && !iframe.src) {
          iframe.src = dataSrc;
        }
      }

      nextButton.addEventListener("click", () => {
        if (index < cards.length - getCardsToShow()) {
          index++;
          updateCarousel();
        }
      });

      prevButton.addEventListener("click", () => {
        if (index > 0) {
          index--;
          updateCarousel();
        }
      });

      // Flip de tarjetas mejorado
      cards.forEach((card) => {
        const flipCard = () => {
          cards.forEach((c) => c !== card && c.classList.remove("flipped"));
          card.classList.toggle("flipped");

          // Cargar el video cuando la tarjeta se voltea
          if (card.classList.contains("flipped")) {
            const iframe = card.querySelector("iframe");
            if (iframe) {
              setTimeout(() => loadYouTubeVideo(iframe), 300);
            }
          }
        };

        card.addEventListener("click", flipCard);

        card.addEventListener("touchend", (e) => {
          e.preventDefault();
          flipCard();
        });
      });

      window.addEventListener("resize", () => {
        index = 0;
        updateCarousel();
      });

      // Prevenir que los clics en el iframe vuelteen la tarjeta
      document.querySelectorAll("iframe").forEach((frame) => {
        frame.addEventListener("click", (e) => {
          e.stopPropagation();
        });
      });

      updateCarousel();
    </script>
  </body>
</html>
